services:
    db:
        image: postgres:17
        container_name: 'postgres_db'
        environment:
            POSTGRES_DB: spenser
            POSTGRES_USER: admin
            POSTGRES_PASSWORD: 1234
        ports:
            - 5432:5432
        healthcheck:
            test: ['CMD-SHELL', 'pg_isready -U admin -d spenser']
            interval: 5s
            timeout: 5s
            retries: 10

    # app:
    #     build: .
    #     container_name: 'spenser'
    #     ports:
    #         - 3000:3000
    #     environment:
    #         NODE_ENV: production
    #         JWT_SECRET: changeme
    #         DB_NAME: spenser
    #         DB_HOST: db
    #         DB_USER: admin
    #         DB_PASSWORD: 1234
    #         DB_PORT: 5432
    #         # Optional demo mode
    #         DEMO: 'true'
    #         DAILY_RESET: 'true'
    #     depends_on:
    #         db:
    #             condition: service_healthy

    umami-db:
        image: postgres:17
        container_name: umami-db
        environment:
            POSTGRES_DB: umami
            POSTGRES_USER: umami
            POSTGRES_PASSWORD: umami

    umami:
        image: ghcr.io/umami-software/umami:postgresql-latest
        container_name: umami
        ports:
            - '3001:3000'
        environment:
            DATABASE_URL: postgresql://umami:umami@umami-db:5432/umami
            APP_SECRET: replace_with_a_secure_random_value
        depends_on:
            - umami-db